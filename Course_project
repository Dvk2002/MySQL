CREATE DATABASE li_chess;

CREATE TABLE users(
id int  AUTO_INCREMENT PRIMARY KEY,
name varchar(255), 
created_at datetime DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE profile(
user_id int,
country varchar(256),
location varchar(256),
user_rating int,
email varchar(256) UNIQUE NOT NULL,
CONSTRAINT profile_white_fk FOREIGN KEY (user_id) REFERENCES users(id)
);


CREATE TABLE games(
id int  AUTO_INCREMENT PRIMARY KEY,
type_game_id int,
white int NOT NULL  comment'user_id',
black int NOT NULL  comment 'user_id',
status_id int,
`result_game` int UNSIGNED comment '1 - white winner, 0- black winner, 0,5 - draw',
tournament_id int,
CONSTRAINT games_type_game_id_fk FOREIGN KEY (type_game_id) REFERENCES types_game(id),
CONSTRAINT games_white_fk FOREIGN KEY (white) REFERENCES users(id),
CONSTRAINT games_black_fk FOREIGN KEY (black) REFERENCES users(id),
CONSTRAINT games_status_id_fk FOREIGN KEY (status_id) REFERENCES status_game(id),
CONSTRAINT games_tournament_id_fk FOREIGN KEY (tournament_id) REFERENCES tournaments(id)
);


CREATE TABLE types_game(
id int  AUTO_INCREMENT PRIMARY KEY,
name varchar(256)
);

CREATE TABLE status_game(
id int  AUTO_INCREMENT PRIMARY KEY,
name varchar(256)
);

CREATE TABLE tournaments(
id int  AUTO_INCREMENT PRIMARY KEY,
name varchar (256),
type_game_id int,
club_id int,
start_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
status_id int,
winner_id int,
CONSTRAINT tournaments_type_game_id_fk FOREIGN KEY (type_game_id) REFERENCES types_game(id),
CONSTRAINT tournaments_club_id_fk FOREIGN KEY (club_id) REFERENCES clubs(id),
CONSTRAINT tournaments_status_id_fk FOREIGN KEY (status_id) REFERENCES status_game(id),
CONSTRAINT tournaments_winner_id_fk FOREIGN KEY (winner_id) REFERENCES users(id)
);

CREATE TABLE messages (
id int  AUTO_INCREMENT PRIMARY KEY,
from_user_id int,
to_user_id int,
body text (65535),
created_at datetime DEFAULT CURRENT_TIMESTAMP,
CONSTRAINT messages_from_user_id_fk FOREIGN KEY (from_user_id) REFERENCES users(id),
CONSTRAINT messages_to_user_id_fk FOREIGN KEY (to_user_id) REFERENCES users(id)
);

CREATE TABLE clubs(
id int  AUTO_INCREMENT PRIMARY KEY,
name varchar (150),
created_at timestamp DEFAULT CURRENT_TIMESTAMP,
is_closed bool
);

CREATE TABLE clubs_members(
club_id int,
user_id int,
is_admin bool,
is_banned TINYTEXT,
CONSTRAINT clubs_members_club_id_fk FOREIGN KEY (club_id) REFERENCES clubs(id),
CONSTRAINT clubs_members_user_id_fk FOREIGN KEY (user_id) REFERENCES users(id)
);
